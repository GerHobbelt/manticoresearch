## Version 2.2.1-beta, 13 nov 2013 {#version-2-2-1-beta-13-nov-2013}

### Major new features {#major-new-features}

*   added [ALTER TABLE](../alter_syntax.md) that can add attributes to disk and RT indexes on the fly
*   added ATTACH support for non-empty RT target indexes
*   added Chinese segmentation with [RLP](../index_configuration_options/morphology.md) (Rosette Linguistics platform) support
*   added English, German [lemmatization](../index_configuration_options/morphology.md) support
*   added [HAVING](../select_syntax.md) support to SELECT statement, filtering on aggregate values is now possible
*   added [N-best GROUP BY](../select_syntax.md) extension to return more than 1 row per group
*   added RT index support for [index_field_lengths=1](../index_configuration_options/indexfield_lengths.md), bitfield attributes, and multiforms
*   added [CSV](../tsvpipecsvpipe_tabcomma_separated_values_data_sour.md), [TSV](../tsvpipecsvpipe_tabcomma_separated_values_data_sour.md) data sources
*   added full [JSON](../data_source_configuration_options/sqlattr_json.md) attributes support, arbitrary JSON documents (with subobjects etc) can now be stored
*   added in-place JSON updates for scalar values
*   added index [type=template](../index_configuration_options/type.md) directive (allows CALL KEYWORDS, CALL SNIPPETS)
*   added [ondisk_attrs](../index_configuration_options/ondiskattrs.md), [ondisk_attrs_default](../searchd_program_configuration_options/ondiskattrs_default.md) directives that keep attributes on disk
*   added table functions mechanism, and [REMOVE_REPEATS()](../select_syntax.md) table function
*   added support for arbitrary expressions in WHERE for DELETE queries

### Ranking related features {#ranking-related-features}

*   added OPTION [local_df=1](../select_syntax.md), an option to aggregate IDFs over local indexes (shards)
*   added [UDF](../sphinx_udfs_user_defined_functions.md) XXX_reinit() method to reload UDFs with `workers=prefork`
*   added comma-separated syntax to [OPTION](../select_syntax.md) `idf`, `tfidf_unnormalized` and `tfidf_normalized` flags
*   added `lccs`, `wlccs`, `exact_order`, `min_gaps`, and `atc` [ranking factors](../search_results_ranking/field-level_ranking_factors.md)
*   added `sphinx_get_XXX_factors()`, a faster interface to access [PACKEDFACTORS()](../expressions,_functions,_and_operators/miscellaneous_functions.md) in UDFs
*   added support for [exact_hit](../search_results_ranking/field-level_ranking_factors.md), [exact_order](../search_results_ranking/field-level_ranking_factors.md) field factors when using more than 32 fields (exact_hit, exact_order)

### Instrumentation features {#instrumentation-features}

*   added [DESCRIBE](../describe_syntax.md) and [--dumpheader](../indextool_command_reference.md) support for tokencount attributes (generated by index_field_lengths=1 directive)
*   added RT index query profile, percentages, totals to [SHOW PROFILE](../show_profile_syntax.md)
*   added `predicted_time`, `dist_predicted_time`, `fetched_docs`, `fetched_hits` counters to [SHOW META](../show_meta_syntax.md)
*   added `total_tokens` and `disk_bytes` counters to [SHOW INDEX STATUS](../show_index_status_syntax.md)

### General features {#general-features}

*   added [ALL()](../5_searching/expressions,_functions,_and_operators/miscellaneous_functions.md#expr-func-all), [ANY()](../5_searching/expressions,_functions,_and_operators/miscellaneous_functions.md#expr-func-any) and [INDEXOF()](../5_searching/expressions,_functions,_and_operators/miscellaneous_functions.md#expr-func-indexof) functions for JSON subarrays
*   added [MIN_TOP_WEIGHT()](../5_searching/expressions,_functions,_and_operators/miscellaneous_functions.md#expr-func-min-top-weight), [MIN_TOP_SORTVAL()](../5_searching/expressions,_functions,_and_operators/miscellaneous_functions.md#expr-func-min-top-sortval) functions
*   added [TOP()](../search_results_ranking/ranking_factor_aggregation_functions.md) aggregate function to expression ranker
*   added a check for duplicated tail hit positions in [indextool --check](../indextool_command_reference.md)
*   added [compact_in](../searchd_query_log_formats/sphinxql_log_format.md) option to [query_log_format=sphinxql](../searchd_program_configuration_options/querylog_format.md)
*   added distance units and calculation method options to [GEODIST()](../5_searching/expressions,_functions,_and_operators/miscellaneous_functions.md#expr-func-geodist) function, optimized it a lot
*   added embedded stopwords/exceptions/wordforms to `--dumpheader`
*   added [indexer --nohup](../indexer_command_reference.md) and [indextool --rotate](../indextool_command_reference.md) switches to check index files before rotating them
*   added scientific notation support for JSON attributes (as per [RFC 4627](http://www.ietf.org/rfc/rfc4627.txt))
*   added several SphinxQL statements to fix MySQL Workbench connection issues (LIKE for session variables, etc.)
*   added [shutdown_timeout](../searchd_program_configuration_options/shutdowntimeout.md) directive to `searchd` config section
*   added signed values support for [INTEGER()](../5_searching/expressions,_functions,_and_operators/type_conversion_functions.md#expr-func-integer) and [UINT()](../5_searching/expressions,_functions,_and_operators/numeric_functions.md#expr-func-uint) function
*   added snippet generation options to [SNIPPET()](../select_syntax.md) function
*   added string filter support in distributed queries, SphinxAPI, SphinxQL query log
*   added support for mixed distributed and local index queries (SELECT * FROM dist1,dist2,local3), and `index_weights` option for that case

### Optimizations, behavior changes, and removals {#optimizations-behavior-changes-and-removals}

*   optimized JSON attributes access (1.12x to 2.0x+ total query speedup depending on the JSON data)
*   optimized SELECT (1.02x to 3.5x speedup, depending on index schema size)
*   optimized [UPDATE](../update_syntax.md) (up to 3x faster on big updates)
*   optimized away internal threads table mutex contention with `workers=threads` and 1000s of threads
*   changed [emptyword -foo] query behavior in cases when emptyword is a stopword or an overshort word, made such queries computable rather than erroneous
*   changed post-morphology [wordforms](../index_configuration_options/wordforms.md) behavior, now it works as `&#039;if ( stem(token)==stem(abc) ) emit(def)&#039;`
*   changed the [config defaults](../sphinx_deprecations_and_changes_in_default_configu.md) to `id64`, `dict=keywords`, `charset_type=utf-8`, `enable_star=1`, `workers=threads`, `mem_limit=128M`, `rt_mem_limit=128M`
*   changed the default SphinxAPI matching mode to [SPH_MATCH_EXTENDED2](../matching_modes.md)
*   disallowed dashes in index names in API requests (just like in SphinxQL)
*   removed legacy `xmlpipe` data source v1, `compat_sphinxql_magics` directive, `SetWeights()` SphinxAPI call, and SPH_SORT_CUSTOM SphinxAPI mode

### Bug fixes {#bug-fixes}

*   fixed #1734, unquoted literal in json subscript could cause a crash, returns &#039;unknown column&#039; now.
*   fixed #1683, under certain conditions [stopwords](../index_configuration_options/stopwords.md) were not taken into account in RT indexes
*   fixed #1648, #1644, when using AOT lemmas with snippet generation, not all the forms got highlighted
*   fixed #1549, [OPTION](../select_syntax.md)`idf=tfidf_normalized` was ignored for distributed queries
*   fixed that [ORDER BY RAND()](../select_syntax.md) was not affected by `index_weights`
*   fixed that float updates with integer values in SphinxQL mistakenly set the float to 0
*   fixed that `predicted_time` was not accumulated with [dist_threads](../searchd_program_configuration_options/distthreads.md)
*   fixed [GROUP_CONCAT](../select_syntax.md) result length limit (was implicitly limited by 1024 bytes)
*   fixed agent query distribution in HA mirroring
*   fixed duplicates check for [quorum operator](../extended_query_syntax.md), it works ok now for expanded keywords
*   fixed off-by-1 query positions of words in indexes with wordforms and [blended characters](../extended_query_syntax.md)
*   fixed wrong `lcs` and [min_best_span_pos](../search_results_ranking/field-level_ranking_factors.md) ranking factor values when any expansion ([expand_keywords](../index_configuration_options/expandkeywords.md) or lemmatize) occurred
*   fixed a crash while creating indexes with [sql_joined_field](../data_source_configuration_options/sqljoined_field.md)